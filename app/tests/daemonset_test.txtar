exec cue export -e out --out yaml ./apps/...
cmp stdout golden.yaml

-- apps/fluentd.cue --
package app

out: (#App & {config: {
	name: "fluentd"
	common: namespace: "logging"

	controller: fluentd: {
		type: "DaemonSet"
		container: main: {
			image: "fluentd:v1.16-1"
			port: forward: port: 24224
			env: {
				FLUENTD_CONF: "fluent.conf"
				FLUENTD_OPT: "-v"
			}
		}
		spec: updateStrategy: type: "RollingUpdate"
	}
}}).out

-- golden.yaml --
- apiVersion: apps/v1
  kind: DaemonSet
  metadata:
    name: fluentd
    namespace: logging
    labels:
      app.kubernetes.io/name: fluentd
      app.kubernetes.io/component: fluentd
  spec:
    selector:
      matchLabels:
        app.kubernetes.io/name: fluentd
        app.kubernetes.io/component: fluentd
    template:
      metadata:
        labels:
          app.kubernetes.io/name: fluentd
          app.kubernetes.io/component: fluentd
      spec:
        containers:
          - name: main
            image: fluentd:v1.16-1
            ports:
              - name: forward
                containerPort: 24224
                protocol: TCP
            env:
              - name: FLUENTD_CONF
                value: fluent.conf
              - name: FLUENTD_OPT
                value: -v
    updateStrategy:
      type: RollingUpdate
- apiVersion: v1
  kind: Service
  metadata:
    name: fluentd
    namespace: logging
    labels:
      app.kubernetes.io/name: fluentd
      app.kubernetes.io/component: fluentd
  spec:
    ports:
      - name: forward
        port: 24224
        protocol: TCP
        targetPort: 24224
    selector:
      app.kubernetes.io/name: fluentd
      app.kubernetes.io/component: fluentd
    type: ClusterIP
