exec cue export -e out --out yaml ./apps/...
cmp stdout golden.yaml

-- apps/foo.cue --
package app

out: (#App & {config: {
	name: "foo"
	common: namespace: "foobar"

	controller: foo: {
		type: "Deployment"
		container: foo: {
			image: "foobar:v2.1.0"
			port: http: port: 8000
		}
		spec: replicas: 1

		service: {
			metadata: labels: "dummy": "im-a-service"
			spec: externalTrafficPolicy: "Local"
		}
	}
}}).out

-- golden.yaml --
- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: foo
    namespace: foobar
    labels:
      app.kubernetes.io/name: foo
      app.kubernetes.io/component: foo
  spec:
    replicas: 1
    selector:
      matchLabels:
        app.kubernetes.io/name: foo
        app.kubernetes.io/component: foo
    template:
      metadata:
        labels:
          app.kubernetes.io/name: foo
          app.kubernetes.io/component: foo
      spec:
        containers:
          - name: foo
            image: foobar:v2.1.0
            ports:
              - name: http
                containerPort: 8000
                protocol: TCP
            env: []
- apiVersion: v1
  kind: Service
  metadata:
    name: foo
    namespace: foobar
    labels:
      app.kubernetes.io/name: foo
      app.kubernetes.io/component: foo
      dummy: im-a-service
  spec:
    ports:
      - name: http
        port: 8000
        protocol: TCP
        targetPort: 8000
    selector:
      app.kubernetes.io/name: foo
      app.kubernetes.io/component: foo
    type: ClusterIP
    externalTrafficPolicy: Local
